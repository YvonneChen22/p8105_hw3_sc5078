---
title: "p8105_hw3_sc5078"
author: "Yvonne Chen"
date: "2023-10-14"
output: github_document
---

# Problem 0
```{r setup}
library(tidyverse)
library(ggridges)
library(patchwork)


library(p8105.datasets)

```

# Problem 1
load the dataset, instacart
```{r import "instacart"}
data("instacart")
```
This dataset comprises `r nrow(instacart)` rows and `r ncol(instacart)` columns. Each row corresponds to a single product within an Instacart order. The variables encompass user, order, and product identifiers, as well as the order placement sequence. Order-level attributes include details about the order's day, time, and days since the previous order. Additionally, item-specific characteristics cover the product name (e.g., Yogurt, Avocado), department (e.g., dairy and eggs, produce), aisle (e.g., yogurt, fresh fruits), and whether the item has been previously ordered by the user. In total, there are `r instacart |> select(product_id) |> distinct() |> count()` distinct products found in `r instacart |> select(user_id, order_id) |> distinct() |> count()` unique orders placed by `r instacart |> select(user_id) |> distinct() |> count()` different users.

```{r}
instacart |> 
  count(aisle) |> 
  arrange(desc(n))
```
This is a table summarizing the number of items ordered from aisle. In total, there are 134 aisles, with fresh vegetables being the most items ordered by far.


```{r}
instacart |> 
  count(aisle) |> 
  filter(n > 10000) |> 
  mutate(aisle = fct_reorder(aisle, n)) |> 
  ggplot(aes(x = aisle, y = n)) + 
  geom_point() + 
  labs(title = "Number of items ordered in each aisle") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

```
The plot shows the number of items ordered in each aisle, limiting this to aisles with more than 10000 items ordered.


```{r}
instacart |> 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) |>
  group_by(aisle) |> 
  count(product_name) |> 
  mutate(rank = min_rank(desc(n))) |> 
  filter(rank < 4) |> 
  arrange(desc(n)) |>
  knitr::kable()
```
This is a table showing the three most popular items in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”.

```{r}
instacart |>
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) |>
  group_by(product_name, order_dow) |>
  summarize(mean_hour = mean(order_hour_of_day)) |>
  pivot_wider(
    names_from = order_dow, 
    values_from = mean_hour) |>
  knitr::kable(digits = 2)
```
This is a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week.


# Problem 2
load the dataset, BRFSS
```{r import "BRFSS"}
data("brfss_smart2010")
```

data cleaning
```{r "BRFSS" data cleaning}
brfss_smart2010 = brfss_smart2010 |>
  janitor::clean_names()|>
  filter(topic %in% "Overall Health") |>
  filter(response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) |>
  mutate(response = ordered(response, levels=c("Poor", "Fair", "Good", "Very good", "Excellent"))) |>
  arrange(response)
```

answering following questions
```{r}
brfss_smart2010 |>
  filter(year %in% c(2002, 2010)) |>
  group_by(year, locationabbr) |>
  filter(n_distinct(locationdesc) >= 7) |>
  summarize()
```
List of states were observed at 7 or more locations in year 2002 and 2010.

```{r}
excellent <- brfss_smart2010 |>
  filter(response %in% "Excellent") |>
  group_by(year, locationabbr) |>
  mutate(
    average_data = mean(data_value)
  ) |>
  summarize(year, average_data)

ggplot(excellent, aes(x = year, y = average_data, color = locationabbr)) +
  geom_line()  +
  labs(title = "Average Value Over Time within a State",
       x = "Year",
       y = "Average Value",
       color = "State") + 
  theme_minimal()
```
Construct a dataset, excellent, that is limited to Excellent responses, and contains, year, state, and a variable that averages the data_value across locations within a state. This is a “spaghetti” plot of this average value over time within a state.

```{r}
brfss_smart2010 |>
  filter(year %in% c(2006, 2010)) |>
  filter(locationabbr %in% "NY") |>
  ggplot(aes(x = response, y = data_value, fill = response)) +
  geom_boxplot() +
  facet_wrap(~year, nrow = 1) +
  labs(title = "Distribution of Data Value for Responses in NY State",
       x = "Response",
       y = "Data Value") +
  theme_minimal()
```
There is a two-panel plot showing, for the years 2006, and 2010, distribution of data_value for responses (“Poor” to “Excellent”) among locations in NY State.



